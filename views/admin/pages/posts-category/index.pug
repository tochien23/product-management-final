extend ../../layouts/default.pug
include ../../mixins/table-tree.pug
include ../../mixins/alert.pug

block main
    if(role.permissions.includes("posts-category_view"))
        +alert-success(5000)

        // Header
        .d-flex.justify-content-between.align-items-center.mb-4
            h2.fw-bold.text-dark.mb-0 Danh mục bài viết
            if(role.permissions.includes("posts-category_create"))
                a.btn.btn-primary.px-4(href=`${prefixAdmin}/posts-category/create`)
                    i.fas.fa-plus.me-2
                    | Thêm mới

        // Posts Category Table
        .bg-white.rounded-3.shadow-sm.overflow-hidden
            .table-responsive
                table.table.table-hover.mb-0.admin-table(checkbox-multi)
                    thead
                        tr
                            th.py-4.px-4.border-0.text-center(width="60" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                .custom-control.custom-checkbox
                                    input.custom-control-input.form-check-input(type="checkbox" name="checkall" id="checkall-posts-category")
                                    label.custom-control-label(for="checkall-posts-category")
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="70" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-hashtag.me-1
                                | STT
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-image.me-1
                                | Hình ảnh
                            th.py-4.border-0.fw-bold.text-muted(width="200" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-folder.me-1
                                | Tên danh mục
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-sort-numeric-down.me-1
                                | Vị trí
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="130" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-toggle-on.me-1
                                | Trạng thái
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="180" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-cogs.me-1
                                | Thao tác

                    tbody
                        each item, index in records
                            tr.table-row-hover.align-middle
                                td.px-4.text-center
                                    .custom-control.custom-checkbox
                                        input.custom-control-input(
                                            type="checkbox"
                                            name="id"
                                            value=item.id
                                            id=`checkbox-posts-category-${item.id}`
                                        )
                                        label.custom-control-label(for=`checkbox-posts-category-${item.id}`)
                                
                                td.text-center.fw-bold.text-muted
                                    | #{index + 1}
                                
                                td.text-center.align-middle
                                    .thumbnail-container
                                        img.rounded.shadow-sm(
                                            src=item.thumbnail
                                            alt=item.title
                                            style="width: 60px; height: 60px; object-fit: cover; border: 2px solid #e9ecef;"
                                            onerror="this.src='/images/150x150.svg'"
                                        )
                                
                                td.align-middle
                                    .fw-semibold.text-dark #{item.title}
                                    .small.text-muted.mt-1 ID: #{item.id}
                                
                                td.text-center.align-middle
                                    .position-input-group
                                        input.form-control.form-control-sm.text-center(
                                            type="number"
                                            value=item.position 
                                            style="width: 70px; border-radius: 8px;"
                                            min="1"
                                            name="position"
                                            title="Vị trí sắp xếp"
                                        )
                                
                                td.text-center.align-middle
                                    if(role.permissions.includes("posts-category_edit"))
                                        if(item.status == "active")
                                            a.status-badge.badge.bg-success.text-white.px-3.py-2.rounded-pill.text-decoration-none(
                                                href="javascript:;" 
                                                data-status=item.status
                                                data-id=item.id
                                                button-change-status
                                                title="Nhấp để thay đổi trạng thái"
                                                style="font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;"
                                            )
                                                i.fas.fa-check-circle.me-1
                                                | Hoạt động
                                        else
                                            a.status-badge.badge.bg-danger.text-white.px-3.py-2.rounded-pill.text-decoration-none(
                                                href="javascript:;" 
                                                data-status=item.status
                                                data-id=item.id
                                                button-change-status
                                                title="Nhấp để thay đổi trạng thái"
                                                style="font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;"
                                            )
                                                i.fas.fa-times-circle.me-1
                                                | Dừng hoạt động
                                    else
                                        if(item.status == "active")
                                            span.badge.bg-success.text-white.px-3.py-2.rounded-pill(style="font-size: 12px;")
                                                i.fas.fa-check-circle.me-1
                                                | Hoạt động
                                        else
                                            span.badge.bg-danger.text-white.px-3.py-2.rounded-pill(style="font-size: 12px;")
                                                i.fas.fa-times-circle.me-1
                                                | Dừng hoạt động
                                
                                td.text-center.align-middle
                                    .btn-group.btn-group-sm(role="group")
                                        a.btn.btn-outline-info.btn-sm.rounded-pill.me-1(
                                            href=`${prefixAdmin}/posts-category/detail/${item.id}`
                                            title="Xem chi tiết"
                                        )
                                            i.fas.fa-eye
                                        
                                        if(role.permissions.includes("posts-category_edit"))
                                            a.btn.btn-outline-warning.btn-sm.rounded-pill.me-1(
                                                href=`${prefixAdmin}/posts-category/edit/${item.id}`
                                                title="Chỉnh sửa"
                                            )
                                                i.fas.fa-edit
                                        
                                        if(role.permissions.includes("posts-category_delete"))
                                            button.btn.btn-outline-danger.btn-sm.rounded-pill(
                                                button-delete
                                                data-id=item.id
                                                title="Xóa danh mục"
                                            )
                                                i.fas.fa-trash-alt

    // Hidden Forms
    form#form-change-status(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/posts-category/change-status`
    )

    form#form-delete-item(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/posts-category/delete`
    )

    script(src="/admin/js/product.js") 