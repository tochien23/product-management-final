extend ../../layouts/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug

block main
    if(role.permissions.includes("products_view"))
        +alert-success(5000)
        
        // Header
        .d-flex.justify-content-between.align-items-center.mb-4
            h2.fw-bold.text-dark.mb-0 Sản phẩm
            if(role.permissions.includes("products_create"))
                a.btn.btn-primary.px-4(href=`${prefixAdmin}/products/create`)
                    i.fas.fa-plus.me-2
                    | Thêm mới

        // Filter Section
        .row.g-3.mb-4
            .col-md-4
                .bg-white.p-3.rounded.border
                    label.form-label.fw-semibold.mb-2 Trạng thái
                    br
                    +filter-status(filterStatus)
            .col-md-4
                .bg-white.p-3.rounded.border
                    label.form-label.fw-semibold.mb-2 Tìm kiếm
                    +search(keyword)
            .col-md-4
                .bg-white.p-3.rounded.border
                    label.form-label.fw-semibold.mb-2 Sắp xếp
                    +sort()

        // Multi Action
        if(role.permissions.includes("products_edit"))
            .mb-3
                +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)

        // Products Table
        .bg-white.rounded-3.shadow-sm.overflow-hidden
            .table-responsive
                table.table.table-hover.mb-0.admin-table(checkbox-multi)
                    thead
                        tr
                            th.py-4.px-4.border-0.text-center(width="60" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                .custom-control.custom-checkbox
                                    input.custom-control-input.form-check-input(type="checkbox" name="checkall" id="checkall-products")
                                    label.custom-control-label(for="checkall-products")
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="70" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-hashtag.me-1
                                | STT
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-image.me-1
                                | Hình ảnh
                            th.py-4.border-0.fw-bold.text-muted(width="200" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-box.me-1
                                | Tên sản phẩm
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-dollar-sign.me-1
                                | Giá bán
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-sort-numeric-down.me-1
                                | Vị trí
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="130" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-toggle-on.me-1
                                | Trạng thái
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="150" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-user.me-1
                                | Người tạo
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="160" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-cogs.me-1
                                | Thao tác

                    tbody
                        each item, index in products
                            tr
                                td.px-4.align-middle
                                    input.form-check-input(
                                        type="checkbox"
                                        name="id"
                                        value=item.id
                                    )
                                td.text-center.align-middle.fw-bold.text-primary
                                    | #{pagination.limitItems*(pagination.currentPage - 1) + (index + 1)}
                                
                                td.text-center.align-middle
                                    img.rounded(
                                        src=item.thumbnail
                                        alt=item.title
                                        style="width: 60px; height: 60px; object-fit: cover;"
                                    )
                                
                                td.align-middle
                                    .fw-semibold.text-dark #{item.title}
                                    .small.text-muted.mt-1 ID: #{item.id}
                                
                                td.text-center.align-middle
                                    .fw-bold.text-success #{item.price}$
                                
                                td.text-center.align-middle
                                    input.form-control.form-control-sm.text-center(
                                        type="number"
                                        value=item.position
                                        style="width: 60px"
                                        min="1"
                                        name="position"
                                    )
                                
                                td.text-center.align-middle
                                    if(role.permissions.includes("products_edit"))
                                        if(item.status == "active")
                                            span.badge.bg-success.px-3.py-2(
                                                style="cursor: pointer"
                                                data-status=item.status
                                                data-id=item.id
                                                button-change-status
                                            ) Hoạt động
                                        else
                                            span.badge.bg-danger.px-3.py-2(
                                                style="cursor: pointer"
                                                data-status=item.status
                                                data-id=item.id
                                                button-change-status
                                            ) Tạm dừng
                                
                                td.text-center.align-middle
                                    .small
                                        .fw-semibold #{item.accountFullName}
                                        .text-muted
                                            +formatDateTime(item.createdBy.createdAt)
                                
                                td.text-center.align-middle
                                    .btn-group.btn-group-sm
                                        a.btn.btn-outline-primary(
                                            href=`${prefixAdmin}/products/detail/${item.id}`
                                            title="Xem"
                                        )
                                            i.fas.fa-eye
                                        
                                        if(role.permissions.includes("products_edit"))
                                            a.btn.btn-outline-warning(
                                                href=`${prefixAdmin}/products/edit/${item.id}`
                                                title="Sửa"
                                            )
                                                i.fas.fa-edit
                                        
                                        if(role.permissions.includes("products_delete"))
                                            button.btn.btn-outline-danger(
                                                button-delete
                                                data-id=item.id
                                                title="Xóa"
                                            )
                                                i.fas.fa-trash

        // Pagination
        .d-flex.justify-content-center.mt-4
            +pagination(pagination)

        // Hidden Forms
        form#form-change-status(
            action=""
            method="POST"
            data-path=`${prefixAdmin}/products/change-status`
        )

        form#form-delete-item(
            action=""
            method="POST"
            data-path=`${prefixAdmin}/products/delete`
        )

        script(src="/admin/js/product.js") 