extend ../../layouts/default.pug

include ../../mixins/alert.pug

block main
    if(role.permissions.includes("accounts_view"))
        +alert-success(5000)

        // Header
        .d-flex.justify-content-between.align-items-center.mb-4
            h2.fw-bold.text-dark.mb-0 Quản lý tài khoản
            if(role.permissions.includes("accounts_create"))
                a.btn.btn-primary.px-4(href=`${prefixAdmin}/accounts/create`)
                    i.fas.fa-plus.me-2
                    | Thêm mới

        // Accounts Table
        .bg-white.rounded-3.shadow-sm.overflow-hidden
            .table-responsive
                table.table.table-hover.mb-0.admin-table
                    thead
                        tr
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="70" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-hashtag.me-1
                                | STT
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="100" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-user-circle.me-1
                                | Avatar
                            th.py-4.border-0.fw-bold.text-muted(width="200" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-user.me-1
                                | Họ và tên
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="150" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-user-tag.me-1
                                | Phân quyền
                            th.py-4.border-0.fw-bold.text-muted(width="200" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-envelope.me-1
                                | Email
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="130" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-toggle-on.me-1
                                | Trạng thái
                            th.py-4.border-0.text-center.fw-bold.text-muted(width="180" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);")
                                i.fas.fa-cogs.me-1
                                | Thao tác
                    tbody
                        if(records.length > 0)
                            each item, index in records
                                tr.table-row-hover.align-middle
                                    td.text-center.fw-bold.text-muted
                                        | #{index + 1}
                                    
                                    td.text-center.align-middle
                                        .avatar-container
                                            img.rounded-circle.shadow-sm(
                                                src=item.avatar
                                                alt=item.fullName
                                                style="width: 50px; height: 50px; object-fit: cover; border: 2px solid #e9ecef;"
                                                onerror="this.src='/images/150x150.svg'"
                                            )
                                    
                                    td.align-middle
                                        .fw-semibold.text-dark #{item.fullName}
                                        .small.text-muted.mt-1 ID: #{item.id}
                                    
                                    td.text-center.align-middle
                                        .badge.bg-primary.bg-opacity-10.text-primary.px-3.py-2.rounded-pill
                                            i.fas.fa-user-tag.me-1
                                            | #{item.role.title}
                                    
                                    td.align-middle
                                        .text-dark #{item.email}
                                        .small.text-muted.mt-1
                                            i.fas.fa-envelope.me-1
                                            | Email liên hệ
                                    
                                    td.text-center.align-middle
                                        if(role.permissions.includes("accounts_edit"))
                                            if(item.status == "active")
                                                a.status-badge.badge.bg-success.text-white.px-3.py-2.rounded-pill.text-decoration-none(
                                                    href="javascript:;" 
                                                    data-status=item.status
                                                    data-id=item.id
                                                    button-change-status
                                                    title="Nhấp để thay đổi trạng thái"
                                                    style="font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;"
                                                )
                                                    i.fas.fa-check-circle.me-1
                                                    | Hoạt động
                                            else
                                                a.status-badge.badge.bg-danger.text-white.px-3.py-2.rounded-pill.text-decoration-none(
                                                    href="javascript:;" 
                                                    data-status=item.status
                                                    data-id=item.id
                                                    button-change-status
                                                    title="Nhấp để thay đổi trạng thái"
                                                    style="font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;"
                                                )
                                                    i.fas.fa-times-circle.me-1
                                                    | Dừng hoạt động
                                        else
                                            if(item.status == "active")
                                                span.badge.bg-success.text-white.px-3.py-2.rounded-pill(style="font-size: 12px;")
                                                    i.fas.fa-check-circle.me-1
                                                    | Hoạt động
                                            else
                                                span.badge.bg-danger.text-white.px-3.py-2.rounded-pill(style="font-size: 12px;")
                                                    i.fas.fa-times-circle.me-1
                                                    | Dừng hoạt động
                                    
                                    td.text-center.align-middle
                                        .btn-group.btn-group-sm(role="group")
                                            a.btn.btn-outline-info.btn-sm.rounded-pill.me-1(
                                                href=`${prefixAdmin}/accounts/detail/${item.id}`
                                                title="Xem chi tiết"
                                            )
                                                i.fas.fa-eye
                                            
                                            if(role.permissions.includes("accounts_edit"))
                                                a.btn.btn-outline-warning.btn-sm.rounded-pill.me-1(
                                                    href=`${prefixAdmin}/accounts/edit/${item.id}`
                                                    title="Chỉnh sửa"
                                                )
                                                    i.fas.fa-edit
                                            
                                            if(role.permissions.includes("accounts_delete"))
                                                button.btn.btn-outline-danger.btn-sm.rounded-pill(
                                                    button-delete
                                                    data-id=item.id
                                                    title="Xóa tài khoản"
                                                )
                                                    i.fas.fa-trash-alt
                        else
                            tr
                                td.text-center.py-5(colspan="7")
                                    .text-muted
                                        i.fas.fa-users.fa-3x.mb-3.d-block.opacity-25
                                        h5 Chưa có tài khoản nào
                                        p.mb-3 Hãy tạo tài khoản đầu tiên để bắt đầu
                                        if(role.permissions.includes("accounts_create"))
                                            a.btn.btn-primary(href=`${prefixAdmin}/accounts/create`)
                                                i.fas.fa-plus.me-2
                                                | Tạo tài khoản mới
    // Hidden Forms
    form#form-change-status(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/accounts/change-status`
    )

    form#form-delete-item(
        action=""
        method="POST"
        data-path=`${prefixAdmin}/accounts/delete`
    )

    script(src="/admin/js/product.js")