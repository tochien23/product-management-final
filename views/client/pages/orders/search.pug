extends ../../layouts/default.pug
include ../../mixins/box-head.pug
include ../../mixins/alert.pug
include ../../mixins/pagination.pug

block main 
    +alert-success(5000)
    +alert-error(5000) 

    // Page Header
    section.page-header.bg-light.py-4.mb-4
        .container
            .row.align-items-center
                .col-md-8
                    h1.page-title.fw-bold.mb-2
                        i.fas.fa-search.me-2
                        | Kết quả tìm kiếm đơn hàng
                    nav(aria-label="breadcrumb")
                        ol.breadcrumb.mb-0
                            li.breadcrumb-item
                                a.text-decoration-none(href="/") Trang chủ
                            li.breadcrumb-item
                                a.text-decoration-none(href="/orders") Đơn hàng
                            li.breadcrumb-item.active(aria-current="page") Kết quả tìm kiếm
                .col-md-4.text-md-end
                    span.badge.bg-success.fs-6 Tìm thấy #{searchInfo.totalResults} kết quả

    // Search Summary
    section.search-summary.py-3.mb-4
        .container
            .search-summary-card.bg-white.rounded-3.shadow-sm.p-4
                .row.align-items-center
                    .col-md-8
                        h6.fw-bold.mb-2
                            i.fas.fa-filter.me-2
                            | Tiêu chí tìm kiếm
                        .search-criteria.small
                            if searchInfo.keyword
                                span.badge.bg-primary.me-2
                                    i.fas.fa-tag.me-1
                                    | #{searchInfo.searchType === 'orderId' ? 'Mã đơn hàng' : 'Thông tin KH'}: #{searchInfo.keyword}
                            if searchInfo.dateFrom
                                span.badge.bg-info.me-2
                                    i.fas.fa-calendar.me-1
                                    | Từ: #{searchInfo.dateFrom}
                            if searchInfo.dateTo
                                span.badge.bg-info.me-2
                                    i.fas.fa-calendar.me-1
                                    | Đến: #{searchInfo.dateTo}
                    .col-md-4.text-md-end
                        .search-actions
                            a.btn.btn-outline-primary.btn-sm.me-2(href="/orders")
                                i.fas.fa-list.me-1
                                | Tất cả đơn hàng
                            button.btn.btn-primary.btn-sm(onclick="history.back()")
                                i.fas.fa-arrow-left.me-1
                                | Tìm kiếm mới

    // Orders List
    section.orders-section.py-4
        .container
            if orders && orders.length > 0
                .orders-list
                    each order, index in orders
                        .order-item.bg-white.rounded-3.shadow-sm.mb-4.overflow-hidden
                            // Order Header
                            .order-header.bg-light.p-3.border-bottom
                                .row.align-items-center
                                    .col-md-8
                                        h5.mb-1
                                            i.fas.fa-box.me-2.text-primary
                                            | Đơn hàng ##{order._id.toString().slice(-6).toUpperCase()}
                                        .order-meta.small.text-muted
                                            i.fas.fa-calendar.me-1
                                            | Đặt ngày: #{order.createdAt.toLocaleDateString('vi-VN')}
                                            span.mx-2 |
                                            i.fas.fa-cube.me-1
                                            | #{order.products.length} sản phẩm
                                        if order.userInfo
                                            .customer-info.small.text-muted.mt-1
                                                i.fas.fa-user.me-1
                                                | #{order.userInfo.fullName}
                                                if order.userInfo.phone
                                                    span.mx-2 |
                                                    i.fas.fa-phone.me-1
                                                    | #{order.userInfo.phone}
                                    .col-md-4.text-md-end
                                        .order-total.mb-2
                                            span.small.text-muted Tổng tiền: 
                                            span.fw-bold.text-success.fs-5 #{order.totalPrice}$
                                        a.btn.btn-outline-primary.btn-sm(href=`/orders/detail/${order._id}`)
                                            i.fas.fa-eye.me-1
                                            | Xem chi tiết

                            // Order Products Preview
                            .order-products.p-3
                                .row
                                    each product, productIndex in order.products.slice(0, 3)
                                        .col-lg-4.col-md-6.mb-3
                                            .product-preview.d-flex.align-items-center.p-2.rounded.bg-light
                                                .product-image.me-3
                                                    img.rounded(
                                                        src=product.productInfo.thumbnail
                                                        alt=product.productInfo.title
                                                        style="width: 50px; height: 50px; object-fit: cover;"
                                                    )
                                                .product-details.flex-grow-1
                                                    .product-name.fw-semibold.small.mb-1 #{product.productInfo.title}
                                                    .product-quantity.text-muted.small SL: #{product.quantity}
                                                    .product-price.text-primary.small #{product.priceNew}$

                                if order.products.length > 3
                                    .more-products.text-center.mt-3
                                        span.small.text-muted.fst-italic
                                            | và #{order.products.length - 3} sản phẩm khác...

                // Pagination
                if pagination.totalPage > 1
                    .pagination-section.mt-5
                        +pagination(pagination, `/orders/search?keyword=${encodeURIComponent(searchInfo.keyword)}&searchType=${searchInfo.searchType}&dateFrom=${searchInfo.dateFrom}&dateTo=${searchInfo.dateTo}`)

            else
                // No Results
                .no-results.text-center.py-5
                    .no-results-content.bg-white.rounded-3.shadow-sm.p-5.mx-auto(style="max-width: 500px;")
                        i.fas.fa-search.fa-4x.text-muted.mb-4
                        h3.fw-bold.text-muted.mb-3 Không tìm thấy kết quả
                        p.text-muted.mb-4 Không có đơn hàng nào phù hợp với tiêu chí tìm kiếm của bạn.
                        .suggestions.text-start.mb-4
                            h6.fw-semibold.mb-2 Gợi ý:
                            ul.list-unstyled.small.text-muted
                                li.mb-1
                                    i.fas.fa-check.me-2.text-success
                                    | Kiểm tra lại từ khóa tìm kiếm
                                li.mb-1
                                    i.fas.fa-check.me-2.text-success
                                    | Thử tìm kiếm với từ khóa khác
                                li.mb-1
                                    i.fas.fa-check.me-2.text-success
                                    | Mở rộng khoảng thời gian tìm kiếm
                        .d-flex.gap-2.justify-content-center
                            button.btn.btn-primary(onclick="history.back()")
                                i.fas.fa-search.me-2
                                | Tìm kiếm lại
                            a.btn.btn-outline-secondary(href="/orders")
                                i.fas.fa-list.me-2
                                | Xem tất cả đơn hàng

    // Custom CSS
    style.
        .order-item {
            transition: all 0.3s ease;
        }
        
        .order-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
        }
        
        .product-preview {
            transition: all 0.3s ease;
        }
        
        .product-preview:hover {
            background-color: #e9ecef !important;
            transform: scale(1.02);
        }
        
        .search-summary-card {
            transition: all 0.3s ease;
        }
        
        .search-summary-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
        }
        
        .search-criteria .badge {
            font-size: 0.8em;
        }
        
        .customer-info {
            border-left: 3px solid #0d6efd;
            padding-left: 10px;
            margin-left: 5px;
        }
        
        @media (max-width: 768px) {
            .order-header .col-md-4 {
                text-align: center !important;
                margin-top: 15px;
            }
            
            .product-preview {
                justify-content: center;
                text-align: center;
            }
            
            .product-preview .product-image {
                margin-bottom: 10px;
            }
            
            .search-actions {
                text-align: center !important;
                margin-top: 15px;
            }
        } 